@namespace BarkUI.Components

<div class="bark-color-picker-wrapper">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="bark-color-picker-label">@Label</label>
    }
    <div class="bark-color-picker-container">
        <input 
            type="color"
            class="bark-color-picker-input"
            value="@Value"
            disabled="@Disabled"
            @oninput="HandleInput"
            @attributes="AdditionalAttributes" />
        <div class="bark-color-picker-preview" style="background-color: @Value;"></div>
        <input 
            type="text"
            class="bark-color-picker-text"
            value="@Value"
            disabled="@Disabled"
            @oninput="HandleTextInput"
            placeholder="#000000" />
    </div>
    @if (!string.IsNullOrEmpty(HelperText))
    {
        <span class="bark-color-picker-helper">@HelperText</span>
    }
</div>

@code {
    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public string Value { get; set; } = "#000000";

    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public string? HelperText { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private async Task HandleInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString() ?? "#000000";
        await ValueChanged.InvokeAsync(Value);
    }

    private async Task HandleTextInput(ChangeEventArgs e)
    {
        var input = e.Value?.ToString() ?? "#000000";
        if (input.StartsWith("#") && (input.Length == 7 || input.Length == 4))
        {
            Value = input;
            await ValueChanged.InvokeAsync(Value);
        }
    }
}
