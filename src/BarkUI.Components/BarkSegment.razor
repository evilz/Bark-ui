@namespace BarkUI.Components

<button 
    type="button"
    class="@GetSegmentClasses()"
    @onclick="HandleClick"
    @attributes="AdditionalAttributes">
    @ChildContent
</button>

@code {
    [CascadingParameter]
    public BarkSegmentGroup? SegmentGroup { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public string? Value { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private bool IsActive => SegmentGroup?.Value == Value;

    private async Task HandleClick()
    {
        if (SegmentGroup != null && Value != null)
        {
            await SegmentGroup.HandleSegmentChange(Value);
        }
    }

    private string GetSegmentClasses()
    {
        var classes = new List<string> { "bark-segment" };
        
        if (IsActive)
        {
            classes.Add("bark-segment--active");
        }

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }
}
