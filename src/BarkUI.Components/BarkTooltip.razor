@namespace BarkUI.Components

<div class="bark-tooltip__container" @onmouseenter="Show" @onmouseleave="Hide" @attributes="AdditionalAttributes">
    @TriggerContent
    @if (isVisible)
    {
        <div class="@GetClasses()" role="tooltip">
            @Content
        </div>
    }
</div>

@code {
    [Parameter]
    public RenderFragment? TriggerContent { get; set; }

    [Parameter]
    public string? Content { get; set; }

    [Parameter]
    public string Placement { get; set; } = "top";

    [Parameter]
    public int DelayMs { get; set; } = 200;

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private bool isVisible = false;
    private System.Threading.Timer? timer;

    private string GetClasses()
    {
        var classes = new List<string> { "bark-tooltip" };
        classes.Add($"bark-tooltip--{Placement}");

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }

    private void Show()
    {
        timer?.Dispose();
        timer = new System.Threading.Timer(_ =>
        {
            InvokeAsync(() =>
            {
                isVisible = true;
                StateHasChanged();
            });
        }, null, DelayMs, System.Threading.Timeout.Infinite);
    }

    private void Hide()
    {
        timer?.Dispose();
        isVisible = false;
        StateHasChanged();
    }

    public void Dispose()
    {
        timer?.Dispose();
    }
}
