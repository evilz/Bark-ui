@namespace BarkUI.Components

<nav class="@GetClasses()" aria-label="Pagination" @attributes="AdditionalAttributes">
    <button class="bark-pagination__button" 
            @onclick="GoToPrevious" 
            disabled="@(CurrentPage <= 1)">
        ‹ Previous
    </button>
    
    @for (int i = GetStartPage(); i <= GetEndPage(); i++)
    {
        var pageNumber = i;
        <button class="@GetPageButtonClasses(pageNumber)" 
                @onclick="@(() => GoToPage(pageNumber))">
            @pageNumber
        </button>
    }
    
    <button class="bark-pagination__button" 
            @onclick="GoToNext" 
            disabled="@(CurrentPage >= TotalPages)">
        Next ›
    </button>
</nav>

@code {
    [Parameter]
    public int CurrentPage { get; set; } = 1;

    [Parameter]
    public EventCallback<int> CurrentPageChanged { get; set; }

    [Parameter]
    public int TotalPages { get; set; } = 1;

    [Parameter]
    public int MaxVisiblePages { get; set; } = 5;

    [Parameter]
    public string Size { get; set; } = "md";

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string GetClasses()
    {
        var classes = new List<string> { "bark-pagination" };
        classes.Add($"bark-pagination--{Size}");

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }

    private string GetPageButtonClasses(int page)
    {
        var classes = new List<string> { "bark-pagination__button" };
        if (page == CurrentPage)
        {
            classes.Add("bark-pagination__button--active");
        }
        return string.Join(" ", classes);
    }

    private int GetStartPage()
    {
        var half = MaxVisiblePages / 2;
        var start = Math.Max(1, CurrentPage - half);
        var end = Math.Min(TotalPages, start + MaxVisiblePages - 1);
        return Math.Max(1, end - MaxVisiblePages + 1);
    }

    private int GetEndPage()
    {
        var start = GetStartPage();
        return Math.Min(TotalPages, start + MaxVisiblePages - 1);
    }

    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            CurrentPage = page;
            await CurrentPageChanged.InvokeAsync(CurrentPage);
        }
    }

    private Task GoToPrevious() => GoToPage(CurrentPage - 1);

    private Task GoToNext() => GoToPage(CurrentPage + 1);
}
