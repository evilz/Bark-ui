@namespace BarkUI.Components

<div class="@GetAccordionItemClasses()">
    <button class="bark-accordion-item-trigger" 
            type="button" 
            @onclick="ToggleExpanded"
            aria-expanded="@IsExpanded"
            @attributes="AdditionalAttributes">
        <span class="bark-accordion-item-trigger-text">@Title</span>
        <span class="bark-accordion-item-trigger-icon @(IsExpanded ? "bark-accordion-item-trigger-icon--expanded" : "")">
            â–¼
        </span>
    </button>
    <div class="bark-accordion-item-content @(IsExpanded ? "bark-accordion-item-content--expanded" : "")">
        <div class="bark-accordion-item-content-text">
            @ChildContent
        </div>
    </div>
</div>

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public string? Title { get; set; }

    [Parameter]
    public bool IsExpanded { get; set; } = false;

    [Parameter]
    public EventCallback<bool> IsExpandedChanged { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private async Task ToggleExpanded()
    {
        IsExpanded = !IsExpanded;
        await IsExpandedChanged.InvokeAsync(IsExpanded);
    }

    private string GetAccordionItemClasses()
    {
        var classes = new List<string> { "bark-accordion-item" };

        if (IsExpanded)
        {
            classes.Add("bark-accordion-item--expanded");
        }

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }
}
