@namespace BarkUI.Components

<div class="bark-number-input-wrapper">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="bark-number-input-label" for="@Id">@Label</label>
    }
    <div class="bark-number-input-container">
        <button type="button" class="bark-number-input__button bark-number-input__button--decrement" @onclick="Decrement" disabled="@(Disabled || Value <= Min)">âˆ’</button>
        <input 
            id="@Id"
            class="@GetInputClasses()" 
            type="number"
            min="@Min"
            max="@Max"
            step="@Step"
            disabled="@Disabled"
            value="@Value"
            @oninput="HandleInput"
            @attributes="AdditionalAttributes" />
        <button type="button" class="bark-number-input__button bark-number-input__button--increment" @onclick="Increment" disabled="@(Disabled || Value >= Max)">+</button>
    </div>
    @if (!string.IsNullOrEmpty(HelperText))
    {
        <span class="bark-number-input-helper">@HelperText</span>
    }
</div>

@code {
    [Parameter]
    public string? Id { get; set; }

    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public int Value { get; set; }

    [Parameter]
    public EventCallback<int> ValueChanged { get; set; }

    [Parameter]
    public int Min { get; set; } = int.MinValue;

    [Parameter]
    public int Max { get; set; } = int.MaxValue;

    [Parameter]
    public int Step { get; set; } = 1;

    [Parameter]
    public string Size { get; set; } = "md";

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public bool HasError { get; set; }

    [Parameter]
    public string? HelperText { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    protected override void OnInitialized()
    {
        if (string.IsNullOrEmpty(Id))
        {
            Id = $"bark-number-input-{Guid.NewGuid()}";
        }
    }

    private async Task HandleInput(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var newValue))
        {
            Value = Math.Clamp(newValue, Min, Max);
            await ValueChanged.InvokeAsync(Value);
        }
    }

    private async Task Increment()
    {
        if (Value < Max)
        {
            Value += Step;
            await ValueChanged.InvokeAsync(Value);
        }
    }

    private async Task Decrement()
    {
        if (Value > Min)
        {
            Value -= Step;
            await ValueChanged.InvokeAsync(Value);
        }
    }

    private string GetInputClasses()
    {
        var classes = new List<string> { "bark-number-input" };
        classes.Add($"bark-number-input--{Size}");
        
        if (HasError)
        {
            classes.Add("bark-number-input--error");
        }
        
        if (Disabled)
        {
            classes.Add("bark-number-input--disabled");
        }

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }
}
