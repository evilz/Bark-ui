@namespace BarkUI.Components

<div class="bark-slider-wrapper">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="bark-slider-label">@Label</label>
    }
    <div class="bark-slider-container">
        <input 
            type="range"
            class="@GetSliderClasses()"
            min="@Min"
            max="@Max"
            step="@Step"
            disabled="@Disabled"
            value="@Value"
            @oninput="HandleInput"
            @attributes="AdditionalAttributes" />
        @if (ShowValue)
        {
            <span class="bark-slider-value">@Value</span>
        }
    </div>
</div>

@code {
    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public int Value { get; set; }

    [Parameter]
    public EventCallback<int> ValueChanged { get; set; }

    [Parameter]
    public int Min { get; set; } = 0;

    [Parameter]
    public int Max { get; set; } = 100;

    [Parameter]
    public int Step { get; set; } = 1;

    [Parameter]
    public bool ShowValue { get; set; } = false;

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public string Size { get; set; } = "md";

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private async Task HandleInput(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var newValue))
        {
            Value = newValue;
            await ValueChanged.InvokeAsync(Value);
        }
    }

    private string GetSliderClasses()
    {
        var classes = new List<string> { "bark-slider" };
        classes.Add($"bark-slider--{Size}");
        
        if (Disabled)
        {
            classes.Add("bark-slider--disabled");
        }

        if (AdditionalAttributes?.ContainsKey("class") == true)
        {
            classes.Add(AdditionalAttributes["class"].ToString() ?? string.Empty);
        }

        return string.Join(" ", classes);
    }
}
